<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard - Your Home of Games</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<script src="https://unpkg.com/parse/dist/parse.min.js"></script>

<script type="module">
  Parse.initialize("jI6Yyy4fA4EwHgkaLn50oUQxSHC7KUQImgxCUB4C", "4clh951SJa1TWPve5zlPwoUQ82Go0BPbMaMxBvwh");
  Parse.serverURL = 'https://parseapi.back4app.com';

  const dashboardStats = document.getElementById("dashboard-stats");
  const addStatForm = document.getElementById("add-stat-form");
  const statTitleInput = document.getElementById("stat-title");
  const statValueInput = document.getElementById("stat-value");
  const logoutBtn = document.getElementById("logout-btn");

  async function checkUser() {
    const currentUser = Parse.User.current();
    if (!currentUser) {
      window.location.href = "index.html";
      return;
    }
    loadStats();
    loadVehicles();
  }

  async function loadStats() {
    try {
      const GameScore = Parse.Object.extend("GameScore");
      const query = new Parse.Query(GameScore);
      const results = await query.find();

      dashboardStats.innerHTML = '';
      results.forEach(stat => {
        dashboardStats.innerHTML += `
          <div class="stat-card">
            <h3>${stat.get("playerName") || "Stats"}</h3>
            <p>Score: ${stat.get("score") || 0}</p>
            <p>Cheat Mode: ${stat.get("cheatMode") ? "Yes" : "No"}</p>
            <button class="update-btn" data-id="${stat.id}">Update</button>
            <button class="delete-btn" data-id="${stat.id}">Delete</button>
          </div>
        `;
      });

      attachButtons();
    } catch (error) {
      console.error("Error loading stats:", error.message);
      dashboardStats.innerHTML = "<p>Error loading stats.</p>";
    }
  }

  function attachButtons() {
    document.querySelectorAll(".update-btn").forEach(btn => {
      btn.onclick = async () => {
        const statId = btn.dataset.id;
        const newScore = prompt("Enter new score:");
        if (!newScore) return;
        try {
          const GameScore = Parse.Object.extend("GameScore");
          const query = new Parse.Query(GameScore);
          const stat = await query.get(statId);
          stat.set("score", parseInt(newScore));
          await stat.save();
          loadStats();
        } catch (error) {
          alert("Error updating: " + error.message);
        }
      };
    });

    document.querySelectorAll(".delete-btn").forEach(btn => {
      btn.onclick = async () => {
        const statId = btn.dataset.id;
        if (!confirm("Are you sure you want to delete this stat?")) return;

        try {
          const GameScore = Parse.Object.extend("GameScore");
          const query = new Parse.Query(GameScore);
          const stat = await query.get(statId);
          await stat.destroy();
          loadStats();
        } catch (error) {
          alert("Error deleting: " + error.message);
        }
      };
    });
  }

  addStatForm?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const playerName = statTitleInput.value.trim();
    const score = parseInt(statValueInput.value);
    if (!playerName || isNaN(score)) return alert("Enter valid data");

    try {
      const GameScore = Parse.Object.extend("GameScore");
      const stat = new GameScore();
      stat.set("playerName", playerName);
      stat.set("score", score);
      stat.set("cheatMode", false);
      await stat.save();
      statTitleInput.value = "";
      statValueInput.value = "";
      loadStats();
    } catch (error) {
      alert("Error adding stat: " + error.message);
    }
  });

  async function loadVehicles() {
    try {
      const B4aVehicle = Parse.Object.extend("B4aVehicle");
      const query = new Parse.Query(B4aVehicle);
      const results = await query.find();
      console.log("Vehicles loaded:");
      results.forEach(v => console.log(v.id, v.get("name"), v.get("price"), v.get("color")));
    } catch (error) {
      console.error("Error loading vehicles:", error.message);
    }
  }

  logoutBtn?.addEventListener("click", async () => {
    await Parse.User.logOut();
    window.location.href = "index.html";
  });

  window.onload = checkUser;
</script>

<style>
body { font-family: 'Poppins', sans-serif; margin:0; background:#f5f5f5; color:#333; }
nav { background:#1f1f2e; text-align:center; padding:12px; }
nav a { color:#fff; text-decoration:none; margin:0 15px; font-weight:600; }
nav a:hover { color:#ffcc00; }
header { padding:40px 20px; text-align:center; background:linear-gradient(135deg, #4b00ff, #7b2cff); color:#fff; }
header h1 { font-size:2rem; margin-bottom:10px; }
main { max-width:1000px; margin:40px auto; padding:20px; text-align:center; }
#dashboard-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; margin-top:20px; }
.stat-card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 3px 8px rgba(0,0,0,0.1); position:relative; }
.stat-card h3 { margin:0 0 10px; color:#4b00ff; }
.stat-card p { font-size:1.2rem; margin:0; font-weight:600; }
.stat-card button { margin-top:10px; padding:5px 10px; border:none; border-radius:6px; cursor:pointer; background:#4b00ff; color:#fff; font-weight:600; margin-right:5px; }
.stat-card button:hover { background:#ffcc00; color:#000; }
form { margin-top:30px; }
input { padding:10px; margin:5px; border-radius:8px; border:1px solid #ccc; }
button#logout-btn { margin-top:20px; padding:10px 20px; background:#ff4444; color:#fff; border:none; border-radius:10px; cursor:pointer; }
button#logout-btn:hover { background:#ffcc00; color:#000; }
footer { margin-top:60px; text-align:center; padding:20px; background:#222; color:#fff; }
footer a:hover { color:#ffcc00; }
footer div { margin-bottom:5px; }
</style>
</head>

<body>
<nav>
  <a href="index.html">Home</a>
  <a href="games.html">Games</a>
  <a href="dashboard.html" class="active">Dashboard</a>
</nav>

<header>
  <h1>Dashboard</h1>
  <p>Manage your game scores and vehicles in real-time using Back4App.</p>
</header>

<main>
  <div id="dashboard-stats">
    <p>Loading statistics...</p>
  </div>

  <form id="add-stat-form">
    <h3>Add New Score</h3>
    <input type="text" id="stat-title" placeholder="Player Name" required>
    <input type="number" id="stat-value" placeholder="Score" required>
    <button type="submit">Add Score</button>
  </form>

  <button id="logout-btn">Logout</button>
</main>

<footer>
  <div>
    <a href="privacy.html">Privacy Policy</a>
    <a href="support.html">Support</a>
  </div>
  <p>Address: Near Beulah International School, Kurudu, Abuja, FCT, Nigeria</p>
  <p>Â© 2026 Your Home of Games</p>
</footer>
</body>
</html>
