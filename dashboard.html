<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard - Your Home of Games</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<script src="https://unpkg.com/parse/dist/parse.min.js"></script>

<script type="module">
  Parse.initialize("jI6Yyy4fA4EwHgkaLn50oUQxSHC7KUQImgxCUB4C", "4clh951SJa1TWPve5zlPwoUQ82Go0BPbMaMxBvwh");
  Parse.serverURL = 'https://parseapi.back4app.com';

  const dashboardStats = document.getElementById("dashboard-stats");
  const logoutBtn = document.getElementById("logout-btn");

  async function checkUser() {
    const currentUser = Parse.User.current();
    if (!currentUser) {
      window.location.href = "index.html";
      return;
    }
    loadStats();          // load initial stats
    setInterval(loadStats, 5000); // refresh every 5 seconds
  }

  async function loadStats() {
    try {
      const GameStats = Parse.Object.extend("GameStats");
      const query = new Parse.Query(GameStats);
      const results = await query.find();

      // Reset dashboard
      dashboardStats.innerHTML = '';

      let totalGames = 0;
      let highScore = 0;
      let totalPlayers = results.length;

      results.forEach(stat => {
        totalGames += stat.get("gamesPlayed") || 0;
        const score = stat.get("highScore") || 0;
        if(score > highScore) highScore = score;
      });

      dashboardStats.innerHTML = `
        <div class="stat-card">
          <h3>Total Games Played</h3>
          <p>${totalGames}</p>
        </div>
        <div class="stat-card">
          <h3>Highest Score</h3>
          <p>${highScore}</p>
        </div>
        <div class="stat-card">
          <h3>Total Players</h3>
          <p>${totalPlayers}</p>
        </div>
      `;

    } catch (error) {
      console.error("Error loading stats:", error.message);
      dashboardStats.innerHTML = "<p>Error loading stats.</p>";
    }
  }

  logoutBtn?.addEventListener("click", async () => {
    await Parse.User.logOut();
    window.location.href = "index.html";
  });

  window.onload = checkUser;
</script>

<style>
body { font-family: 'Poppins', sans-serif; margin:0; background:#f5f5f5; color:#333; }
nav { background:#1f1f2e; text-align:center; padding:12px; }
nav a { color:#fff; text-decoration:none; margin:0 15px; font-weight:600; }
nav a:hover { color:#ffcc00; }
header { padding:40px 20px; text-align:center; background:linear-gradient(135deg, #4b00ff, #7b2cff); color:#fff; }
header h1 { font-size:2rem; margin-bottom:10px; }
main { max-width:1000px; margin:40px auto; padding:20px; text-align:center; }
#dashboard-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; margin-top:20px; }
.stat-card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
.stat-card h3 { margin:0 0 10px; color:#4b00ff; }
.stat-card p { font-size:1.2rem; margin:0; font-weight:600; }
button#logout-btn { margin-top:20px; padding:10px 20px; background:#ff4444; color:#fff; border:none; border-radius:10px; cursor:pointer; }
button#logout-btn:hover { background:#ffcc00; color:#000; }
footer { margin-top:60px; text-align:center; padding:20px; background:#222; color:#fff; }
footer a:hover { color:#ffcc00; }
footer div { margin-bottom:5px; }
</style>
</head>

<body>
<nav>
  <a href="index.html">Home</a>
  <a href="games.html">Games</a>
  <a href="dashboard.html" class="active">Dashboard</a>
</nav>

<header>
  <h1>Dashboard</h1>
  <p>Real-time game stats for all players.</p>
</header>

<main>
  <div id="dashboard-stats">
    <p>Loading statistics...</p>
  </div>

  <button id="logout-btn">Logout</button>
</main>

<footer>
  <div>
    <a href="privacy.html">Privacy Policy</a>
    <a href="support.html">Support</a>
  </div>
  <p>Address: Near Beulah International School, Kurudu, Abuja, FCT, Nigeria</p>
  <p>Â© 2026 Your Home of Games</p>
</footer>
</body>
</html>
