<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Portal</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; margin: 0; padding: 10px; }
        h1 { text-align: center; color: #ffcc00; }
        #game-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columns for mobile phones */
            gap: 10px;
            padding: 10px;
        }
        .game-card {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 1px solid #444;
        }
        .game-card img { width: 100%; border-radius: 5px; height: auto; }
        .game-card h3 { font-size: 14px; margin: 8px 0; height: 35px; overflow: hidden; }
        .play-btn {
            display: block;
            background: #ffcc00;
            color: black;
            text-decoration: none;
            padding: 8px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 13px;
        }
        .controls { text-align: center; margin: 20px 0; display: flex; justify-content: center; align-items: center; gap: 15px; }
        button { padding: 10px 15px; background: #444; color: white; border: none; border-radius: 5px; }
        button:disabled { opacity: 0.3; }
    </style>
</head>
<body>

    <h1>Top Games</h1>
    <div id="game-grid">Loading Games...</div>

    <div class="controls">
        <button id="prevBtn" onclick="changePage(-1)">Prev</button>
        <span id="pageDisplay">Page 1</span>
        <button id="nextBtn" onclick="changePage(1)">Next</button>
    </div>

    <script>
        // 1. SECURITY CHECK
        if (localStorage.getItem("isLoggedIn") !== "true") {
            window.location.href = "index.html";
        }

        let currentPage = 1;
        const maxPages = 4;
        const sid = "2R229";

        async function fetchGames(page) {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = "<h3>Loading...</h3>";
            
            // Use a proxy-style URL or cache-buster to help mobile browsers load the feed
            const url = `https://feeds.gamepix.com/v2/json?sid=${sid}&pagination=24&page=${page}&t=${Date.now()}`;
            
            try {
                const response = await fetch(url);
                const result = await response.json();
                
                if (result && result.data) {
                    displayGames(result.data);
                    updateUI();
                } else {
                    grid.innerHTML = "<h3>No games found.</h3>";
                }
            } catch (error) {
                grid.innerHTML = "<h3>Error loading games. Try disabling Ad-Block.</h3>";
                console.error(error);
            }
        }

        function displayGames(games) {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = ""; 

            games.forEach(game => {
                // Force HTTPS for mobile security
                const thumb = game.thumbnailUrl.replace("http://", "https://");
                const gameUrl = game.url.replace("http://", "https://");

                const div = document.createElement('div');
                div.className = 'game-card';
                div.innerHTML = `
                    <img src="${thumb}" alt="${game.title}">
                    <h3>${game.title}</h3>
                    <a href="${gameUrl}" target="_blank" class="play-btn">PLAY</a>
                `;
                grid.appendChild(div);
            });
        }

        function changePage(step) {
            currentPage += step;
            fetchGames(currentPage);
            window.scrollTo(0, 0);
        }

        function updateUI() {
            document.getElementById('pageDisplay').innerText = `Page ${currentPage} of ${maxPages}`;
            document.getElementById('prevBtn').disabled = (currentPage === 1);
            document.getElementById('nextBtn').disabled = (currentPage === maxPages);
        }

        window.onload = () => fetchGames(1);
    </script>
</body>
</html>

