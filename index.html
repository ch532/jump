<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SkylPWorld – Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Parse SDK -->
  <script src="https://unpkg.com/parse/dist/parse.min.js"></script>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f5f5f5; color:#000; transition: background 0.3s, color 0.3s; }
    nav { background:#1f1f2e; text-align:center; padding:12px; }
    nav a { color:#fff; text-decoration:none; margin:0 15px; font-weight:600; }
    nav a:hover { color:#ffcc00; }
    .container { max-width:400px; margin:40px auto; background:#fff; padding:30px; border-radius:12px; text-align:center; }
    input, button, select, label { width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid #ccc; box-sizing:border-box; }
    button { border:none; font-weight:bold; cursor:pointer; }
    .fb { background:#1877f2; color:#fff; }
    .logout { background:#ff3b3b; color:#fff; }
    footer { text-align:center; background:#222; color:#fff; padding:20px; margin-top:40px; }
    footer a { color:#ffcc00; text-decoration:none; margin:0 10px; }
  </style>
</head>
<body>

<nav>
  <a href="index.html" class="active">Home</a>
  <a href="games.html">Games</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="support.html">Support</a>
  <a href="privacy.html">Privacy Policy</a>
  <a href="#settingsBox">Settings</a>
</nav>

<!-- AUTH CONTAINER -->
<div class="container" id="authBox">
  <h2>Welcome to SkylPWorld</h2>

  <!-- Facebook Login -->
  <button id="fbLogin" class="fb">Continue with Facebook</button>

  <!-- Google Login -->
  <div id="googleSignInDiv"></div>
</div>

<!-- LOGOUT CONTAINER -->
<div class="container" id="logoutBox" style="display:none;">
  <h3>You are logged in</h3>
  <button id="logoutBtn" class="logout">Logout</button>
</div>

<!-- SETTINGS SECTION -->
<div class="container" id="settingsBox" style="display:none;">
  <h3>Settings</h3>
  <p>Update your account info:</p>

  <input id="newUsername" placeholder="New Username">
  <input id="newMail" placeholder="New Mail">

  <label>
    <input type="checkbox" id="notifPref">
    Enable Email Notifications
  </label>

  <label>
    Theme:
    <select id="themeSelect">
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>
  </label>

  <button id="updateBtn">Update Account</button>
  <p id="loginType"></p>
</div>

<!-- Load Facebook SDK -->
<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '10069345703165605',
      cookie     : true,
      xfbml      : true,
      version    : 'v16.0'
    });

    Parse.FacebookUtils.init({
      appId      : '10069345703165605',
      cookie     : true,
      xfbml      : true,
      version    : 'v16.0'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

<script>
  // Initialize Parse
  Parse.initialize(
    "jI6Yyy4fA4EwHgkaLn50oUQImgxCUB4C",
    "4clh951SJa1TWPve5zlPwoUQ82Go0BPbMaMxBvwh"
  );
  Parse.serverURL = "https://parseapi.back4app.com/";

  const authBox = document.getElementById("authBox");
  const logoutBox = document.getElementById("logoutBox");
  const settingsBox = document.getElementById("settingsBox");

  const fbLogin = document.getElementById("fbLogin");
  const logoutBtn = document.getElementById("logoutBtn");

  const newUsername = document.getElementById("newUsername");
  const newMail = document.getElementById("newMail");
  const updateBtn = document.getElementById("updateBtn");
  const loginType = document.getElementById("loginType");
  const notifPref = document.getElementById("notifPref");
  const themeSelect = document.getElementById("themeSelect");

  // Check if user is already logged in
  const currentUser = Parse.User.current();
  if(currentUser){
    authBox.style.display="none";
    logoutBox.style.display="block";
    settingsBox.style.display="block";

    newUsername.value = currentUser.get("username") || "";
    newMail.value = currentUser.get("email") || "";
    notifPref.checked = currentUser.get("notifPref") || false;
    themeSelect.value = currentUser.get("theme") || "light";
    applyTheme(themeSelect.value);

    loginType.innerText = "Login Type: " + (currentUser.get("authData") && currentUser.get("authData").facebook ? "Facebook" : "Google");
  }

  // Facebook Login
  fbLogin.onclick = function() {
    FB.login(function(response) {
      console.log(response);
      if (response.authResponse) {
        Parse.FacebookUtils.logIn(null, {scope: 'email'}).then((user) => {
          alert("Logged in with Facebook: " + user.get("username"));
          location.href="dashboard.html";
        }).catch((err) => {
          alert("Facebook login failed: " + err.message);
        });
      } else {
        alert("Facebook login cancelled or failed.");
      }
    }, {config_id: '2316598995528367'});
  };

  // Google Login
  function handleCredentialResponse(response) {
    const base64Url = response.credential.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    const user = JSON.parse(jsonPayload);

    alert("Logged in as: " + user.name + " (" + user.email + ")");
    authBox.style.display="none";
    logoutBox.style.display="block";
    settingsBox.style.display="block";
    loginType.innerText = "Login Type: Google";

    // Optionally, store user in Parse for records
    const parseUser = new Parse.User();
    parseUser.set("username", user.name);
    parseUser.set("email", user.email);
    parseUser.signUp().catch(()=>{}); // ignore if user exists
  }

  window.onload = function() {
    google.accounts.id.initialize({
      client_id: "1009884656935-vmqn83rlp53nkahd67b6qtr6dru6e33j.apps.googleusercontent.com",
      callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
      document.getElementById("googleSignInDiv"),
      { theme: "outline", size: "large", text: "signin_with" }
    );
    google.accounts.id.prompt();
  };

  // Logout
  logoutBtn.onclick = async ()=>{
    await Parse.User.logOut();
    location.reload();
  };

  // Update settings
  updateBtn.onclick = async ()=>{
    try{
      const user = Parse.User.current();
      user.set("username", newUsername.value);
      user.set("email", newMail.value);
      user.set("notifPref", notifPref.checked);
      user.set("theme", themeSelect.value);
      await user.save();
      applyTheme(themeSelect.value);
      alert("Account updated successfully!");
    }catch(e){
      alert("Update failed: "+e.message);
    }
  };

  // Theme helper
  function applyTheme(theme){
    if(theme === "dark"){
      document.body.style.background = "#222";
      document.body.style.color = "#fff";
    } else {
      document.body.style.background = "#f5f5f5";
      document.body.style.color = "#000";
    }
  }

  themeSelect.addEventListener("change", ()=>{
    applyTheme(themeSelect.value);
  });
</script>

<footer>
  <p>Address: Near Beulah International School, Kurudu, Abuja, FCT, Nigeria</p>
  <p>
    <a href="privacy.html">Privacy Policy</a> |
    <a href="support.html">Support</a>
  </p>
  <p>© 2026 SkylPWorld</p>
</footer>
</body>
</html>
