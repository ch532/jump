<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Skyl P World</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Sign-In -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3XR1R2P73Y"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3XR1R2P73Y');
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin:0;
      background:#f5f5f5;
      color:#000;
      text-align:center;
      padding:50px;
    }
    nav {
      background:#1f1f2e;
      text-align:center;
      padding:12px;
    }
    nav a {
      color:#fff;
      text-decoration:none;
      margin:0 15px;
      font-weight:600;
    }
    nav a:hover {
      color:#ffcc00;
    }
    .container {
      max-width:400px;
      margin:60px auto;
      background:#fff;
      padding:30px;
      border-radius:12px;
      box-shadow:0 3px 10px rgba(0,0,0,0.1);
    }
    .g_id_signin {
      margin-top:20px;
      width:100%;
    }
    button {
      padding:12px 20px;
      margin-top:15px;
      border:none;
      border-radius:10px;
      background:#4b00ff;
      color:#fff;
      font-weight:600;
      cursor:pointer;
    }
    button.logout {
      background:#ff3b3b;
    }
    footer {
      text-align:center;
      background:#222;
      color:#fff;
      padding:20px;
      margin-top:40px;
    }
    footer a {
      color:#ffcc00;
      text-decoration:none;
      margin:0 10px;
    }
    #logoutBtn, #loginSuccess {
      display: none;
    }
  </style>
</head>
<body>

<nav>
  <a href="index.html" class="active">Home</a>
  <a href="games.html">Games</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="support.html">Support</a>
  <a href="privacy.html">Privacy Policy</a>
  <a href="#settingsBox">Settings</a>
</nav>

<!-- Login Wall -->
<div class="container" id="auth-placeholder">
  <div id="googleButtonDiv"></div>
  <p>Please log in to access all features and other sections.</p>
  <p id="loginSuccess" style="color:green; font-weight:bold;">Login Successful!</p>
  <button id="logoutBtn" class="logout">Logout</button>
</div>

<!-- Settings Section -->
<div class="container" id="settingsBox">
  <h3>Settings</h3>
  <label>
    <input type="checkbox" id="notifPref"> Enable Email Notifications
  </label>
  <label>
    Theme:
    <select id="themeSelect">
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>
  </label>
  <button id="updateBtn">Update Settings</button>
</div>

<script>
  const authPlaceholder = document.getElementById("auth-placeholder");
  const googleBtnDiv = document.getElementById("googleButtonDiv");
  const loginSuccess = document.getElementById("loginSuccess");
  const logoutBtn = document.getElementById("logoutBtn");
  const settingsBox = document.getElementById("settingsBox");
  const themeSelect = document.getElementById("themeSelect");
  const notifPref = document.getElementById("notifPref");

  function applyTheme(theme){
    if(theme === "dark"){
      document.body.style.background = "#222";
      document.body.style.color = "#fff";
    } else {
      document.body.style.background = "#f5f5f5";
      document.body.style.color = "#000";
    }
  }

  function handleCredentialResponse(response) {
    console.log("JWT token:", response.credential);

    // Save login state
    localStorage.setItem("isLoggedIn", "true");

    // Hide Google button
    googleBtnDiv.style.display = "none";

    // Show login success message
    loginSuccess.style.display = "block";

    // Show logout button & settings
    logoutBtn.style.display = "inline-block";
    settingsBox.style.display = "block";

    applyTheme(themeSelect.value);
  }

  function initGoogleLogin() {
    google.accounts.id.initialize({
      client_id: "1009884656935-vmqn83rlp53nkahd67b6qtr6dru6e33j.apps.googleusercontent.com",
      callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
      googleBtnDiv,
      { theme: "outline", size: "large" }
    );
  }

  logoutBtn.onclick = function() {
    localStorage.removeItem("isLoggedIn");
    location.reload();
  };

  document.getElementById("updateBtn").onclick = function(){
    alert("Settings updated!\nTheme: "+themeSelect.value+"\nEmail notifications: "+notifPref.checked);
    applyTheme(themeSelect.value);
  };

  window.onload = function() {
    if(localStorage.getItem("isLoggedIn") === "true"){
      console.log("Access granted via session");
      googleBtnDiv.style.display = "none";
      loginSuccess.style.display = "block";
      logoutBtn.style.display = "inline-block";
      settingsBox.style.display = "block";
    } else {
      initGoogleLogin();
    }
  };
</script>

  <script>
  const LOGIN_DURATION_MS = 30 * 60 * 1000; // 30 minutes

  function handleCredentialResponse(response) {
    console.log("JWT token:", response.credential);

    // Save login state with timestamp
    const loginData = {
      token: response.credential,
      timestamp: Date.now()
    };
    localStorage.setItem("googleLogin", JSON.stringify(loginData));

    // Hide login button, show welcome message
    document.getElementById("google-btn-container").style.display = "none";
    document.getElementById("welcome-message").style.display = "block";
    alert("Login Successful!");
  }

  function checkLoginStatus() {
    const data = JSON.parse(localStorage.getItem("googleLogin"));
    if (data) {
      const elapsed = Date.now() - data.timestamp;
      if (elapsed < LOGIN_DURATION_MS) {
        // User is still logged in
        document.getElementById("google-btn-container").style.display = "none";
        document.getElementById("welcome-message").style.display = "block";
        return true;
      } else {
        // Expired → remove login
        localStorage.removeItem("googleLogin");
      }
    }
    return false;
  }

  function logout() {
    localStorage.removeItem("googleLogin");
    document.getElementById("google-btn-container").style.display = "block";
    document.getElementById("welcome-message").style.display = "none";
    google.accounts.id.disableAutoSelect(); // prevents auto-login
  }

  window.onload = function() {
    google.accounts.id.initialize({
      client_id: "1009884656935-vmqn83rlp53nkahd67b6qtr6dru6e33j.apps.googleusercontent.com",
      callback: handleCredentialResponse
    });

    if (!checkLoginStatus()) {
      google.accounts.id.renderButton(
        document.getElementById("google-btn-container"),
        { theme: "outline", size: "large" }
      );
      google.accounts.id.prompt(); // optional One Tap
    }
  };
</script>

<footer>
  <p>Address: Near Beulah International School, Kurudu, Abuja, FCT, Nigeria</p>
  <p>
    <a href="privacy.html">Privacy Policy</a> |
    <a href="support.html">Support</a>
  </p>
  <p>© 2026 Skyl P World</p>
</footer>

</body>
</html>
